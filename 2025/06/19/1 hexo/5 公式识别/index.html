<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">

	<!-- title -->
	
		<title>
			
				5 公式识别 |
					
						Note
		</title>

		<!-- keywords,description -->
		
					

								<!-- favicon -->
								
									<link rel="shortcut icon" href="/favicon.ico">
										


											<!-- search -->
											<script>
												var searchEngine = "";
												if (typeof searchEngine == "undefined" || searchEngine == null || searchEngine == "")
												{
													searchEngine = "https://www.google.com/search?q=";
												}
												var homeHost = "BenChenEternity.github.io";
												if (typeof homeHost == "undefined" || homeHost == null || homeHost == "")
												{
													homeHost = window.location.host;
												}
											</script>


											
<link rel="stylesheet" href="/css/main.css">

												
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

													
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">

														
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">


															
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script>

																
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

																	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

																		
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

																			
<script src="/js/main.js"></script>


																				
																					
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

																						
<script src="https://cdn.jsdelivr.net/npm/valine@v1.5.1/dist/Valine.min.js"></script>

																							
																								
<meta name="generator" content="Hexo 7.3.0"></head>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
	integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">

<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
	integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz"
	crossorigin="anonymous"></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
	integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
	onload="renderMathInElement(document.body);"></script>

<body>
	<header id="header">
    <a id="title" href="/" class="logo">Note</a>

	<ul id="menu">
    
      <li class="menu-item">
        <a href="/about" class="menu-item-link">About</a>
      </li>
    

    

    

    
  
    
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="search" placeholder="Press Enter to search">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										1 hexo
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/06/09/1%20hexo/1%20%E9%85%8D%E7%BD%AE/">
                     
										    1 配置
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/30/1%20hexo/2%20hexo%E8%BF%81%E7%A7%BB/">
                     
										    2 hexo迁移
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/15/1%20hexo/3%20%E6%96%87%E7%AB%A0%E7%BC%96%E5%8F%B7%E7%BC%96%E6%8E%92/">
                     
										    3 文章编号编排
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/24/1%20hexo/4%20%E5%85%AC%E5%BC%8F%E5%BC%95%E7%94%A8/">
                     
										    4 公式引用
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/2025/06/19/1%20hexo/5%20%E5%85%AC%E5%BC%8F%E8%AF%86%E5%88%AB/">
                     
										    5 公式识别
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										2 学习
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										1 数学
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/06/15/2%20%E5%AD%A6%E4%B9%A0/1%20%E6%95%B0%E5%AD%A6/SVD%E5%A5%87%E5%BC%82%E5%80%BC%E5%88%86%E8%A7%A3/">
                     
										    奇异值分解
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										2 力学
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										1 流体力学
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/06/09/2%20%E5%AD%A6%E4%B9%A0/2%20%E5%8A%9B%E5%AD%A6/1%20%E6%B5%81%E4%BD%93%E5%8A%9B%E5%AD%A6/1%20%E6%96%B9%E7%A8%8B%E7%BB%AA%E8%AE%BA/">
                     
										    1 方程绪论
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/09/2%20%E5%AD%A6%E4%B9%A0/2%20%E5%8A%9B%E5%AD%A6/1%20%E6%B5%81%E4%BD%93%E5%8A%9B%E5%AD%A6/2%20%E4%BC%AF%E5%8A%AA%E5%88%A9%E6%96%B9%E7%A8%8B/">
                     
										    2 伯努利方程
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/23/2%20%E5%AD%A6%E4%B9%A0/2%20%E5%8A%9B%E5%AD%A6/1%20%E6%B5%81%E4%BD%93%E5%8A%9B%E5%AD%A6/3%20N-S%E6%96%B9%E7%A8%8B%E7%9A%84%E8%A7%A3%E6%9E%90%E8%A7%A3/">
                     
										    3 N-S方程的解析解
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/07/01/2%20%E5%AD%A6%E4%B9%A0/2%20%E5%8A%9B%E5%AD%A6/1%20%E6%B5%81%E4%BD%93%E5%8A%9B%E5%AD%A6/4%20%E6%B9%8D%E6%B5%81/">
                     
										    4 湍流
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/07/10/2%20%E5%AD%A6%E4%B9%A0/2%20%E5%8A%9B%E5%AD%A6/1%20%E6%B5%81%E4%BD%93%E5%8A%9B%E5%AD%A6/5%20%E7%9B%B8%E4%BC%BC%E5%8E%9F%E7%90%86%E5%92%8C%E9%87%8F%E7%BA%B2%E5%88%86%E6%9E%90/">
                     
										    5 相似原理和量纲分析
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										2 计算流体力学
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										SPH光滑粒子法
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/07/28/2%20%E5%AD%A6%E4%B9%A0/2%20%E5%8A%9B%E5%AD%A6/2%20%E8%AE%A1%E7%AE%97%E6%B5%81%E4%BD%93%E5%8A%9B%E5%AD%A6/SPH%E5%85%89%E6%BB%91%E7%B2%92%E5%AD%90%E6%B3%95/SPH%E6%96%B9%E6%B3%95%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/">
                     
										    SPH方法基本原理
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/07/28/2%20%E5%AD%A6%E4%B9%A0/2%20%E5%8A%9B%E5%AD%A6/2%20%E8%AE%A1%E7%AE%97%E6%B5%81%E4%BD%93%E5%8A%9B%E5%AD%A6/SPH%E5%85%89%E6%BB%91%E7%B2%92%E5%AD%90%E6%B3%95/%E7%BB%AA%E8%AE%BA/">
                     
										    绪论
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										3 计算机科学
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										1 计算机图形学
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										1 理论
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/06/15/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/1%20%E7%90%86%E8%AE%BA/1%20%E7%BB%AA%E8%AE%BA/">
                     
										    1 绪论
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/15/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/1%20%E7%90%86%E8%AE%BA/2%20VAO%20%E4%B8%8E%20VBO/">
                     
										    2 VAO 与 VBO
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/09/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/1%20%E7%90%86%E8%AE%BA/3%20%E7%A9%BA%E9%97%B4%E5%8F%98%E6%8D%A2/">
                     
										    3 空间变换
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/16/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/1%20%E7%90%86%E8%AE%BA/4%20%E6%AC%A7%E6%8B%89%E8%A7%92/">
                     
										    4 欧拉角
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/19/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/1%20%E7%90%86%E8%AE%BA/5%20%E7%BD%91%E6%A0%BC%E6%9B%B2%E9%9D%A2/">
                     
										    5 网格曲面
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/16/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/1%20%E7%90%86%E8%AE%BA/6%20%E5%85%89%E7%85%A7/">
                     
										    6 光照
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/19/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/1%20%E7%90%86%E8%AE%BA/7%20%E7%BD%91%E6%A0%BC%E6%9B%B2%E9%9D%A2/">
                     
										    7 网格曲面
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										2 实践
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/06/09/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/2%20%E5%AE%9E%E8%B7%B5/1%20openGL%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/">
                     
										    1 openGL环境安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/20/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/2%20%E5%AE%9E%E8%B7%B5/2%20%E6%83%B3%E6%B3%95%E6%9E%84%E6%80%9D/">
                     
										    2 想法构思
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/20/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/2%20%E5%AE%9E%E8%B7%B5/3%20%E5%BA%94%E7%94%A8%E5%88%9B%E5%BB%BA/">
                     
										    3 应用创建
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/20/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/2%20%E5%AE%9E%E8%B7%B5/4%20%E4%B8%96%E7%95%8C%E5%AE%9A%E4%B9%89/">
                     
										    4 世界定义
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/20/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/2%20%E5%AE%9E%E8%B7%B5/5%20%E6%91%84%E5%83%8F%E6%9C%BA%E5%AE%9A%E4%B9%89/">
                     
										    5 摄像机定义
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/20/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/2%20%E5%AE%9E%E8%B7%B5/6%20%E7%9D%80%E8%89%B2%E5%99%A8%E5%AE%9A%E4%B9%89/">
                     
										    6 着色器定义
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/21/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/2%20%E5%AE%9E%E8%B7%B5/7%20%E5%A4%96%E9%83%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/">
                     
										    7 外部资源管理
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/21/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/2%20%E5%AE%9E%E8%B7%B5/8%20%E5%AF%B9%E8%B1%A1/">
                     
										    8 对象
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/21/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/2%20%E5%AE%9E%E8%B7%B5/9%20%E5%AF%B9%E8%B1%A1%E7%BD%91%E6%A0%BC/">
                     
										    9 对象网格
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/21/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/2%20%E5%AE%9E%E8%B7%B5/%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA/">
                     
										    对象存储
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										2 数值分析
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										常微分方程数值解法
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/07/29/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2%20%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90/%E5%B8%B8%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B%E6%95%B0%E5%80%BC%E8%A7%A3%E6%B3%95/%E4%B8%80%E9%98%B6%E5%B8%B8%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B/">
                     
										    一阶常微分方程
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										插值
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/06/26/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/2%20%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90/%E6%8F%92%E5%80%BC/%E7%BB%AA%E8%AE%BA/">
                     
										    绪论
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										3 设计模式经验之谈
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/07/17/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/3%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%BB%8F%E9%AA%8C%E4%B9%8B%E8%B0%88/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/">
                     
										    架构设计
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										FAQ
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/09/04/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/FAQ/Cpp/">
                     
										    Cpp
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										3 思考
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/07/02/3%20%E6%80%9D%E8%80%83/%E6%80%BB%E7%BB%93%E5%8F%8D%E6%80%9D%E4%B8%8E%E5%B1%95%E6%9C%9B/">
                     
										    硕士三年应该怎样度过
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										4 杂项
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										1 实用小工具
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/06/19/4%20%E6%9D%82%E9%A1%B9/1%20%E5%AE%9E%E7%94%A8%E5%B0%8F%E5%B7%A5%E5%85%B7/1%20%E4%BB%A3%E7%A0%81%E6%89%81%E5%B9%B3%E5%8C%96%E5%B0%8F%E5%B7%A5%E5%85%B7/">
                     
										    1 代码扁平化小工具
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/08/18/4%20%E6%9D%82%E9%A1%B9/1%20%E5%AE%9E%E7%94%A8%E5%B0%8F%E5%B7%A5%E5%85%B7/2%20%E5%90%84%E7%A7%8D%E5%8A%A0%E9%80%9F%E8%AE%BF%E9%97%AE/">
                     
										    2 各种加速访问
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/08/18/4%20%E6%9D%82%E9%A1%B9/1%20%E5%AE%9E%E7%94%A8%E5%B0%8F%E5%B7%A5%E5%85%B7/3%20%E6%90%9C%E7%B4%A2%E7%A5%9E%E5%99%A8/">
                     
										    3 搜索神器
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										2 环境配置
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/09/04/4%20%E6%9D%82%E9%A1%B9/2%20%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/FAQ-Qt%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/">
                     
										    FAQ-Qt安装与配置
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/09/16/4%20%E6%9D%82%E9%A1%B9/2%20%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/windows%20python%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">
                     
										    windows python环境配置
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/08/18/4%20%E6%9D%82%E9%A1%B9/2%20%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/%E7%94%B5%E8%84%91%E5%85%B1%E4%BA%AB%E7%A1%AC%E7%9B%98/">
                     
										    电脑共享硬盘
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										5 实践
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										软件开发
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/09/11/5%20%E5%AE%9E%E8%B7%B5/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/Qt%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E6%A0%87%E5%87%86%E5%8C%96%E6%B5%81%E7%A8%8B/">
                     
										    Qt项目开发标准化流程
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										6 游戏
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										1 minecraft
									</a>
									
							<ul>
								<li class="file">
									<a href="/2025/06/13/6%20%E6%B8%B8%E6%88%8F/1%20minecraft/01%20Better%20MC/">
                     
										    01 Better MC
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/13/6%20%E6%B8%B8%E6%88%8F/1%20minecraft/02%20%E8%84%86%E9%AA%A8%E7%97%87/">
                     
										    02 脆骨症
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/14/6%20%E6%B8%B8%E6%88%8F/1%20minecraft/03%20%E5%B9%B8%E8%BF%90%E4%B8%96%E7%95%8C%E5%85%A5%E4%BE%B5/">
                     
										    03 幸运世界入侵
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2025/06/14/6%20%E6%B8%B8%E6%88%8F/1%20minecraft/04-Cisco-s-Fantasy-Medieval/">
                     
										    04 Cisco's Fantasy Medieval
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content" class="content">
		<h1 id="article-title">
	5 公式识别
</h1>

<!-- meta -->
<div class="article-meta">
	

	<span>NicolasDavout</span>
	<span>2025-06-19 16:42:41</span>

  <div id="article-categories">
    
		  <span>Categories：</span>
      
    

    
		    <span>Tags：</span>
        
    
  </div>

</div>

<!-- content -->
<div id="article-content">
	<h2 id="公式识别">公式识别</h2>
<h3 id="simpletex">SimpleTex</h3>
<p>公式手打很累，使用 SimpleTex 直接识别即可</p>
<p><a target="_blank" rel="noopener" href="https://simpletex.cn/ai/latex_ocr">SimpleTex</a></p>
<h3 id="问题simpletex-需要付费">问题：SimpleTex 需要付费</h3>
<p>结果发现现在要求开通vip，否则一个图像需要排队识别。</p>
<h3 id="simpletex-没他不行">SimpleTex 没他不行！</h3>
<p>对比了很多的 latex 识别服务提供商，发现 SimpleTex 目前能发现效果最好的。</p>
<p>如何才能“一劳永逸”免费使用 SimpleTex 的公式识别功能呢。</p>
<p>发现 SimpleTex 的 API 每天都会赠送调用额度，于是直接创建一个号专门调用 API 来实现应用 SimpleTex 的服务识别。根据 SimpleTex 的说明需要预存 20 元。</p>
<h2 id="识别软件">识别软件</h2>
<h3 id="思路">思路</h3>
<p>自己写一个能够读取用户剪贴板图片或者路径中图片的软件，然后调用 api 识别，供用户复制，这样直接相当于每个月免费使用 1000 次，直接用不完。</p>
<h3 id="下载">下载</h3>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/BenChenEternity/Images/main/%E5%85%AC%E5%BC%8F%E8%AF%86%E5%88%AB.exe">公式识别.exe</a></p>
<h3 id="使用方法">使用方法</h3>
<p>1.注册平台账号 -&gt; <a target="_blank" rel="noopener" href="https://simpletex.cn/api">API接口</a> ，平台会要求预存20元。</p>
<p>2.获得 APP ID 和 APP Secret 填写进入软件配置</p>
<p><img src="https://raw.githubusercontent.com/BenChenEternity/Images/main/20250811020115787.png" /></p>
<p><strong>注意：软件代码贴在末尾，不信任、怕泄露信息的自己去 python 构建可执行文件</strong></p>
<p>3.复制图片或者电脑文件系统的图片到软件中（ctrl+V粘贴），自动实现识别</p>
<h3 id="代码">代码</h3>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> tkinter <span class="hljs-keyword">as</span> tk
<span class="hljs-keyword">from</span> tkinter <span class="hljs-keyword">import</span> messagebox, Toplevel, Label, Entry, Button, Text, Frame, Canvas, Radiobutton, StringVar
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> ImageGrab, ImageTk, Image
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> tempfile
<span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> platform
<span class="hljs-keyword">import</span> urllib.parse
<span class="hljs-keyword">import</span> io


<span class="hljs-comment"># ==============================================================================</span>
<span class="hljs-comment">#  SimpleTex API Client (As provided by the user, with minor corrections)</span>
<span class="hljs-comment"># ==============================================================================</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleTexClient</span>:
    <span class="hljs-string">&quot;&quot;&quot;</span>
<span class="hljs-string">    SimpleTex API Python 客户端</span>
<span class="hljs-string"></span>
<span class="hljs-string">    该客户端封装了基于 APP ID 和 APP Secret 的安全鉴权方式，</span>
<span class="hljs-string">    用于调用 SimpleTex 开放平台的公式识别等服务。</span>
<span class="hljs-string"></span>
<span class="hljs-string">    Attributes:</span>
<span class="hljs-string">        app_id (str): 您的开放平台应用 APP ID.</span>
<span class="hljs-string">        app_secret (str): 您的开放平台应用 APP Secret.</span>
<span class="hljs-string">    &quot;&quot;&quot;</span>

    BASE_URL = <span class="hljs-string">&quot;https://server.simpletex.cn&quot;</span>

    <span class="hljs-comment"># API 错误代码中文解释</span>
    ERROR_CODES = &#123;
        <span class="hljs-number">401</span>: <span class="hljs-string">&quot;鉴权失败，请检查您的APP ID和APP Secret是否正确，并确保签名算法无误。&quot;</span>,
        <span class="hljs-number">402</span>: <span class="hljs-string">&quot;资源不足，请检查您的账户余额或资源包情况。&quot;</span>,
        <span class="hljs-number">413</span>: <span class="hljs-string">&quot;图片文件过大或没有上传图片文件。&quot;</span>,
        <span class="hljs-number">429</span>: <span class="hljs-string">&quot;API调用频率超出限制 (QPS或并发量)，请稍后再试。&quot;</span>,
        <span class="hljs-number">500</span>: <span class="hljs-string">&quot;服务器内部错误，请稍后重试或联系SimpleTex团队。&quot;</span>,
        <span class="hljs-number">503</span>: <span class="hljs-string">&quot;服务器维护中，请稍后再试。&quot;</span>,
        <span class="hljs-number">404</span>: <span class="hljs-string">&quot;找不到对应的API接口，请检查请求地址。&quot;</span>,
        <span class="hljs-number">405</span>: <span class="hljs-string">&quot;错误的请求方法（应为POST）。&quot;</span>
    &#125;

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, app_id: <span class="hljs-built_in">str</span>, app_secret: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">&quot;&quot;&quot;</span>
<span class="hljs-string">        初始化SimpleTex客户端.</span>
<span class="hljs-string"></span>
<span class="hljs-string">        Args:</span>
<span class="hljs-string">            app_id (str): 您的开放平台应用 APP ID.</span>
<span class="hljs-string">            app_secret (str): 您的开放平台应用 APP Secret.</span>
<span class="hljs-string">        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> app_id <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> app_secret:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;APP ID 和 APP Secret 不能为空&quot;</span>)
        <span class="hljs-variable language_">self</span>.app_id = app_id
        <span class="hljs-variable language_">self</span>.app_secret = app_secret

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_random_str</span>(<span class="hljs-params">self, length: <span class="hljs-built_in">int</span> = <span class="hljs-number">16</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">&quot;&quot;&quot;生成指定长度的随机字符串&quot;&quot;&quot;</span>
        chars = <span class="hljs-string">&#x27;AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789&#x27;</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(random.choices(chars, k=length))

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_generate_auth_headers</span>(<span class="hljs-params">self, data: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
        <span class="hljs-string">&quot;&quot;&quot;</span>
<span class="hljs-string">        根据请求数据生成包含签名的鉴权头部信息.</span>
<span class="hljs-string"></span>
<span class="hljs-string">        Args:</span>
<span class="hljs-string">            data (dict): POST请求中的非文件参数字典.</span>
<span class="hljs-string"></span>
<span class="hljs-string">        Returns:</span>
<span class="hljs-string">            dict: 包含了鉴权所需字段的headers字典.</span>
<span class="hljs-string">        &quot;&quot;&quot;</span>
        headers = &#123;
            <span class="hljs-string">&#x27;app-id&#x27;</span>: <span class="hljs-variable language_">self</span>.app_id,
            <span class="hljs-string">&#x27;timestamp&#x27;</span>: <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(time.time())),
            <span class="hljs-string">&#x27;random-str&#x27;</span>: <span class="hljs-variable language_">self</span>._random_str(<span class="hljs-number">16</span>)
        &#125;

        <span class="hljs-comment"># 合并所有需要签名的参数</span>
        params_to_sign = &#123;**headers, **data&#125;

        <span class="hljs-comment"># 按照key的字典序升序排序</span>
        sorted_keys = <span class="hljs-built_in">sorted</span>(params_to_sign.keys())

        <span class="hljs-comment"># 构造待签名字符串</span>
        pre_sign_string = <span class="hljs-string">&quot;&amp;&quot;</span>.join([<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;key&#125;</span>=<span class="hljs-subst">&#123;params_to_sign[key]&#125;</span>&quot;</span> <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> sorted_keys])

        <span class="hljs-comment"># 拼接App Secret</span>
        pre_sign_string += <span class="hljs-string">f&quot;&amp;secret=<span class="hljs-subst">&#123;self.app_secret&#125;</span>&quot;</span>

        <span class="hljs-comment"># 计算MD5签名</span>
        sign = hashlib.md5(pre_sign_string.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).hexdigest()
        headers[<span class="hljs-string">&#x27;sign&#x27;</span>] = sign

        <span class="hljs-keyword">return</span> headers

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">recognize_formula</span>(<span class="hljs-params">self, image_path: <span class="hljs-built_in">str</span>, model_type: <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;standard&#x27;</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">&quot;&quot;&quot;</span>
<span class="hljs-string">        调用SimpleTex公式识别API.</span>
<span class="hljs-string"></span>
<span class="hljs-string">        Args:</span>
<span class="hljs-string">            image_path (str): 待识别的本地图片文件路径.</span>
<span class="hljs-string">            model_type (str, optional): 使用的模型类型.</span>
<span class="hljs-string">                                         &#x27;standard&#x27; (标准模型) 或 &#x27;turbo&#x27; (轻量模型).</span>
<span class="hljs-string">                                         默认为 &#x27;standard&#x27;.</span>
<span class="hljs-string"></span>
<span class="hljs-string">        Returns:</span>
<span class="hljs-string">            str: 识别出的LaTeX字符串.</span>
<span class="hljs-string"></span>
<span class="hljs-string">        Raises:</span>
<span class="hljs-string">            FileNotFoundError: 如果图片路径不存在.</span>
<span class="hljs-string">            requests.exceptions.RequestException: 如果发生网络错误.</span>
<span class="hljs-string">            ValueError: 如果API返回错误.</span>
<span class="hljs-string">        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(image_path):
            <span class="hljs-keyword">raise</span> FileNotFoundError(<span class="hljs-string">f&quot;错误: 图片文件未找到 -&gt; <span class="hljs-subst">&#123;image_path&#125;</span>&quot;</span>)

        <span class="hljs-comment"># 根据模型类型选择API接口地址</span>
        <span class="hljs-keyword">if</span> model_type == <span class="hljs-string">&#x27;standard&#x27;</span>:
            url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.BASE_URL&#125;</span>/api/latex_ocr&quot;</span>
        <span class="hljs-keyword">elif</span> model_type == <span class="hljs-string">&#x27;turbo&#x27;</span>:
            url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.BASE_URL&#125;</span>/api/latex_ocr_turbo&quot;</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;模型类型错误, 请选择 &#x27;standard&#x27; 或 &#x27;turbo&#x27;&quot;</span>)

        <span class="hljs-comment"># 对于公式识别API，非文件参数data为空</span>
        data = &#123;&#125;

        <span class="hljs-comment"># 生成鉴权headers</span>
        headers = <span class="hljs-variable language_">self</span>._generate_auth_headers(data)

        <span class="hljs-comment"># 准备上传的文件</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(image_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:
            files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>: (os.path.basename(image_path), f.read())&#125;
            <span class="hljs-comment"># 发送POST请求</span>
            response = requests.post(url, headers=headers, data=data, files=files)

        <span class="hljs-comment"># 检查HTTP状态码</span>
        <span class="hljs-keyword">if</span> response.status_code != <span class="hljs-number">200</span>:
            error_message = <span class="hljs-variable language_">self</span>.ERROR_CODES.get(response.status_code, <span class="hljs-string">f&quot;未知的HTTP错误: <span class="hljs-subst">&#123;response.status_code&#125;</span>&quot;</span>)
            <span class="hljs-keyword">raise</span> requests.exceptions.RequestException(<span class="hljs-string">f&quot;请求失败: <span class="hljs-subst">&#123;error_message&#125;</span>\n响应内容: <span class="hljs-subst">&#123;response.text&#125;</span>&quot;</span>)

        <span class="hljs-comment"># 解析返回的JSON数据</span>
        result = response.json()

        <span class="hljs-comment"># 检查API业务状态</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result.get(<span class="hljs-string">&#x27;status&#x27;</span>):
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;API返回错误: <span class="hljs-subst">&#123;result.get(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-string">&#x27;未知错误&#x27;</span>)&#125;</span>&quot;</span>)

        <span class="hljs-comment"># 提取并返回LaTeX内容</span>
        latex_text = result.get(<span class="hljs-string">&#x27;res&#x27;</span>, &#123;&#125;).get(<span class="hljs-string">&#x27;latex&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)
        <span class="hljs-keyword">if</span> latex_text <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            latex_text = <span class="hljs-string">&#x27;&#x27;</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;识别结果异常: <span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)

        <span class="hljs-keyword">return</span> latex_text


<span class="hljs-comment"># ==============================================================================</span>
<span class="hljs-comment">#  Tkinter Application (with new features)</span>
<span class="hljs-comment"># ==============================================================================</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span>(tk.Tk):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">super</span>().__init__()
        <span class="hljs-variable language_">self</span>.title(<span class="hljs-string">&quot;SimpleTex Formula Recognition&quot;</span>)
        <span class="hljs-variable language_">self</span>.geometry(<span class="hljs-string">&quot;550x800&quot;</span>)  <span class="hljs-comment"># Increased height for formula display</span>

        <span class="hljs-variable language_">self</span>.app_id = StringVar()
        <span class="hljs-variable language_">self</span>.app_secret = StringVar()
        <span class="hljs-variable language_">self</span>.model_type = StringVar(value=<span class="hljs-string">&#x27;standard&#x27;</span>)
        <span class="hljs-variable language_">self</span>.simpletex_client = <span class="hljs-literal">None</span>
        <span class="hljs-variable language_">self</span>.temp_image_path = <span class="hljs-literal">None</span>
        <span class="hljs-variable language_">self</span>.image_on_canvas = <span class="hljs-literal">None</span>
        <span class="hljs-variable language_">self</span>.formula_image_on_canvas = <span class="hljs-literal">None</span>  <span class="hljs-comment"># Keep a reference to the formula image</span>
        <span class="hljs-variable language_">self</span>.is_temp_file = <span class="hljs-literal">False</span>
        <span class="hljs-variable language_">self</span>.debounce_timer = <span class="hljs-literal">None</span>

        <span class="hljs-comment"># --- MODIFIED: Added variable to track text changes ---</span>
        <span class="hljs-variable language_">self</span>.last_known_text = <span class="hljs-string">&quot;&quot;</span>

        <span class="hljs-comment"># -- Configuration File Setup --</span>
        <span class="hljs-variable language_">self</span>.config_dir = os.path.join(os.path.expanduser(<span class="hljs-string">&#x27;~&#x27;</span>), <span class="hljs-string">&#x27;.simpletex_gui_client&#x27;</span>)
        <span class="hljs-variable language_">self</span>.config_file = os.path.join(<span class="hljs-variable language_">self</span>.config_dir, <span class="hljs-string">&#x27;config.json&#x27;</span>)
        os.makedirs(<span class="hljs-variable language_">self</span>.config_dir, exist_ok=<span class="hljs-literal">True</span>)
        <span class="hljs-variable language_">self</span>.load_config()

        <span class="hljs-comment"># -- UI Creation --</span>
        <span class="hljs-variable language_">self</span>.create_widgets()
        <span class="hljs-variable language_">self</span>.bind_events()

        <span class="hljs-comment"># -- Initial Check --</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.app_id.get() <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.app_secret.get():
            <span class="hljs-variable language_">self</span>.after(<span class="hljs-number">100</span>, <span class="hljs-variable language_">self</span>.open_config_window)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-variable language_">self</span>.initialize_client()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_widgets</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># --- Top Frame for Configuration ---</span>
        top_frame = Frame(<span class="hljs-variable language_">self</span>, padx=<span class="hljs-number">10</span>, pady=<span class="hljs-number">10</span>)
        top_frame.pack(fill=<span class="hljs-string">&#x27;x&#x27;</span>)

        Label(top_frame, text=<span class="hljs-string">&quot;Ready. Paste an image or file path (Ctrl+V).&quot;</span>).pack(side=<span class="hljs-string">&#x27;left&#x27;</span>)

        controls_frame = Frame(top_frame)
        controls_frame.pack(side=<span class="hljs-string">&#x27;right&#x27;</span>)

        Radiobutton(controls_frame, text=<span class="hljs-string">&quot;Standard&quot;</span>, variable=<span class="hljs-variable language_">self</span>.model_type, value=<span class="hljs-string">&#x27;standard&#x27;</span>).pack(side=<span class="hljs-string">&#x27;left&#x27;</span>)
        Radiobutton(controls_frame, text=<span class="hljs-string">&quot;Turbo&quot;</span>, variable=<span class="hljs-variable language_">self</span>.model_type, value=<span class="hljs-string">&#x27;turbo&#x27;</span>).pack(side=<span class="hljs-string">&#x27;left&#x27;</span>,
                                                                                                padx=(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>))
        Button(controls_frame, text=<span class="hljs-string">&quot;Configure&quot;</span>, command=<span class="hljs-variable language_">self</span>.open_config_window).pack(side=<span class="hljs-string">&#x27;left&#x27;</span>)

        <span class="hljs-comment"># --- Middle Frame for Image Pasting ---</span>
        image_frame = Frame(<span class="hljs-variable language_">self</span>, relief=<span class="hljs-string">&#x27;sunken&#x27;</span>, borderwidth=<span class="hljs-number">2</span>, width=<span class="hljs-number">530</span>, height=<span class="hljs-number">250</span>)
        image_frame.pack(padx=<span class="hljs-number">10</span>, pady=<span class="hljs-number">5</span>, expand=<span class="hljs-literal">False</span>)
        image_frame.pack_propagate(<span class="hljs-literal">False</span>)

        <span class="hljs-variable language_">self</span>.canvas = Canvas(image_frame, bg=<span class="hljs-string">&#x27;white&#x27;</span>)
        <span class="hljs-variable language_">self</span>.canvas.pack(fill=<span class="hljs-string">&#x27;both&#x27;</span>, expand=<span class="hljs-literal">True</span>)
        <span class="hljs-variable language_">self</span>.canvas_text = <span class="hljs-variable language_">self</span>.canvas.create_text(<span class="hljs-number">265</span>, <span class="hljs-number">125</span>, text=<span class="hljs-string">&quot;Press Ctrl+V to paste an image or file path&quot;</span>,
                                                   font=(<span class="hljs-string">&#x27;Arial&#x27;</span>, <span class="hljs-number">12</span>), fill=<span class="hljs-string">&#x27;grey&#x27;</span>)

        <span class="hljs-comment"># --- Frame for LaTeX Results ---</span>
        Label(<span class="hljs-variable language_">self</span>, text=<span class="hljs-string">&quot;Recognition Result (LaTeX):&quot;</span>, justify=<span class="hljs-string">&#x27;left&#x27;</span>, anchor=<span class="hljs-string">&#x27;w&#x27;</span>).pack(fill=<span class="hljs-string">&#x27;x&#x27;</span>, padx=<span class="hljs-number">10</span>,
                                                                                         pady=(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>))
        <span class="hljs-variable language_">self</span>.result_text = Text(<span class="hljs-variable language_">self</span>, height=<span class="hljs-number">8</span>, wrap=<span class="hljs-string">&#x27;word&#x27;</span>, font=(<span class="hljs-string">&#x27;Courier New&#x27;</span>, <span class="hljs-number">11</span>))
        <span class="hljs-variable language_">self</span>.result_text.pack(fill=<span class="hljs-string">&#x27;x&#x27;</span>, expand=<span class="hljs-literal">False</span>, padx=<span class="hljs-number">10</span>, pady=(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>))

        <span class="hljs-comment"># --- NEW: Frame for Rendered Formula ---</span>
        Label(<span class="hljs-variable language_">self</span>, text=<span class="hljs-string">&quot;Rendered Formula:&quot;</span>, justify=<span class="hljs-string">&#x27;left&#x27;</span>, anchor=<span class="hljs-string">&#x27;w&#x27;</span>).pack(fill=<span class="hljs-string">&#x27;x&#x27;</span>, padx=<span class="hljs-number">10</span>, pady=(<span class="hljs-number">5</span>, <span class="hljs-number">0</span>))
        formula_frame = Frame(<span class="hljs-variable language_">self</span>, relief=<span class="hljs-string">&#x27;sunken&#x27;</span>, borderwidth=<span class="hljs-number">2</span>, width=<span class="hljs-number">530</span>, height=<span class="hljs-number">200</span>)
        formula_frame.pack(padx=<span class="hljs-number">10</span>, pady=<span class="hljs-number">5</span>, fill=<span class="hljs-string">&#x27;both&#x27;</span>, expand=<span class="hljs-literal">True</span>)
        formula_frame.pack_propagate(<span class="hljs-literal">False</span>)

        <span class="hljs-variable language_">self</span>.formula_canvas = Canvas(formula_frame, bg=<span class="hljs-string">&#x27;white&#x27;</span>)
        <span class="hljs-variable language_">self</span>.formula_canvas.pack(fill=<span class="hljs-string">&#x27;both&#x27;</span>, expand=<span class="hljs-literal">True</span>)
        <span class="hljs-variable language_">self</span>.formula_canvas_text = <span class="hljs-variable language_">self</span>.formula_canvas.create_text(<span class="hljs-number">265</span>, <span class="hljs-number">100</span>, text=<span class="hljs-string">&quot;Formula will be rendered here&quot;</span>,
                                                                   font=(<span class="hljs-string">&#x27;Arial&#x27;</span>, <span class="hljs-number">12</span>), fill=<span class="hljs-string">&#x27;grey&#x27;</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bind_events</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># Bind Ctrl+V to the whole window</span>
        <span class="hljs-variable language_">self</span>.bind(<span class="hljs-string">&#x27;&lt;Control-v&gt;&#x27;</span>, <span class="hljs-variable language_">self</span>.handle_paste)
        <span class="hljs-keyword">if</span> platform.system() == <span class="hljs-string">&quot;Darwin&quot;</span>:  <span class="hljs-comment"># Handle Cmd+V on macOS</span>
            <span class="hljs-variable language_">self</span>.bind(<span class="hljs-string">&#x27;&lt;Command-v&gt;&#x27;</span>, <span class="hljs-variable language_">self</span>.handle_paste)

        <span class="hljs-variable language_">self</span>.result_text.bind(<span class="hljs-string">&quot;&lt;KeyRelease&gt;&quot;</span>, <span class="hljs-variable language_">self</span>.on_text_change)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_config</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">if</span> os.path.exists(<span class="hljs-variable language_">self</span>.config_file):
                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-variable language_">self</span>.config_file, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:
                    config = json.load(f)
                    <span class="hljs-variable language_">self</span>.app_id.<span class="hljs-built_in">set</span>(config.get(<span class="hljs-string">&#x27;app_id&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>))
                    <span class="hljs-variable language_">self</span>.app_secret.<span class="hljs-built_in">set</span>(config.get(<span class="hljs-string">&#x27;app_secret&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>))
        <span class="hljs-keyword">except</span> (json.JSONDecodeError, IOError) <span class="hljs-keyword">as</span> e:
            messagebox.showerror(<span class="hljs-string">&quot;Config Error&quot;</span>, <span class="hljs-string">f&quot;Could not load configuration file.\n<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_config</span>(<span class="hljs-params">self</span>):
        config = &#123;<span class="hljs-string">&#x27;app_id&#x27;</span>: <span class="hljs-variable language_">self</span>.app_id.get(), <span class="hljs-string">&#x27;app_secret&#x27;</span>: <span class="hljs-variable language_">self</span>.app_secret.get()&#125;
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-variable language_">self</span>.config_file, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> f:
                json.dump(config, f, indent=<span class="hljs-number">4</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">except</span> IOError <span class="hljs-keyword">as</span> e:
            messagebox.showerror(<span class="hljs-string">&quot;Config Error&quot;</span>, <span class="hljs-string">f&quot;Could not save configuration file.\n<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">initialize_client</span>(<span class="hljs-params">self</span>):
        app_id = <span class="hljs-variable language_">self</span>.app_id.get()
        app_secret = <span class="hljs-variable language_">self</span>.app_secret.get()
        <span class="hljs-keyword">if</span> app_id <span class="hljs-keyword">and</span> app_secret:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-variable language_">self</span>.simpletex_client = SimpleTexClient(app_id, app_secret)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;SimpleTex client initialized successfully.&quot;</span>)
            <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
                messagebox.showerror(<span class="hljs-string">&quot;Initialization Error&quot;</span>, <span class="hljs-built_in">str</span>(e))
                <span class="hljs-variable language_">self</span>.simpletex_client = <span class="hljs-literal">None</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-variable language_">self</span>.simpletex_client = <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">open_config_window</span>(<span class="hljs-params">self</span>):
        config_window = Toplevel(<span class="hljs-variable language_">self</span>)
        config_window.title(<span class="hljs-string">&quot;Configuration&quot;</span>)
        config_window.geometry(<span class="hljs-string">&quot;400x150&quot;</span>)
        config_window.resizable(<span class="hljs-literal">False</span>, <span class="hljs-literal">False</span>)
        config_window.transient(<span class="hljs-variable language_">self</span>)
        config_window.grab_set()

        Label(config_window, text=<span class="hljs-string">&quot;APP ID:&quot;</span>).grid(row=<span class="hljs-number">0</span>, column=<span class="hljs-number">0</span>, padx=<span class="hljs-number">10</span>, pady=<span class="hljs-number">10</span>, sticky=<span class="hljs-string">&#x27;e&#x27;</span>)
        Entry(config_window, textvariable=<span class="hljs-variable language_">self</span>.app_id, width=<span class="hljs-number">40</span>).grid(row=<span class="hljs-number">0</span>, column=<span class="hljs-number">1</span>, padx=<span class="hljs-number">10</span>, pady=<span class="hljs-number">10</span>)

        Label(config_window, text=<span class="hljs-string">&quot;APP Secret:&quot;</span>).grid(row=<span class="hljs-number">1</span>, column=<span class="hljs-number">0</span>, padx=<span class="hljs-number">10</span>, pady=<span class="hljs-number">10</span>, sticky=<span class="hljs-string">&#x27;e&#x27;</span>)
        Entry(config_window, textvariable=<span class="hljs-variable language_">self</span>.app_secret, width=<span class="hljs-number">40</span>, show=<span class="hljs-string">&#x27;*&#x27;</span>).grid(row=<span class="hljs-number">1</span>, column=<span class="hljs-number">1</span>, padx=<span class="hljs-number">10</span>, pady=<span class="hljs-number">10</span>)

        <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_save</span>():
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.app_id.get() <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.app_secret.get():
                messagebox.showwarning(<span class="hljs-string">&quot;Input Required&quot;</span>, <span class="hljs-string">&quot;APP ID and APP Secret cannot be empty.&quot;</span>, parent=config_window)
                <span class="hljs-keyword">return</span>
            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.save_config():
                messagebox.showinfo(<span class="hljs-string">&quot;Success&quot;</span>, <span class="hljs-string">&quot;Configuration saved.&quot;</span>, parent=config_window)
                <span class="hljs-variable language_">self</span>.initialize_client()
                config_window.destroy()

        Button(config_window, text=<span class="hljs-string">&quot;Save&quot;</span>, command=on_save).grid(row=<span class="hljs-number">2</span>, column=<span class="hljs-number">1</span>, padx=<span class="hljs-number">10</span>, pady=<span class="hljs-number">10</span>, sticky=<span class="hljs-string">&#x27;e&#x27;</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_paste</span>(<span class="hljs-params">self, event=<span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">try</span>:
            image = ImageGrab.grabclipboard()
        <span class="hljs-keyword">except</span> Exception:
            image = <span class="hljs-literal">None</span>

        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(image, Image.Image):
            <span class="hljs-variable language_">self</span>.canvas.delete(<span class="hljs-variable language_">self</span>.canvas_text)
            <span class="hljs-variable language_">self</span>.update_canvas_image(image)
            <span class="hljs-keyword">with</span> tempfile.NamedTemporaryFile(delete=<span class="hljs-literal">False</span>, suffix=<span class="hljs-string">&quot;.png&quot;</span>) <span class="hljs-keyword">as</span> temp_file:
                image.save(temp_file, <span class="hljs-string">&quot;PNG&quot;</span>)
                <span class="hljs-variable language_">self</span>.temp_image_path = temp_file.name
                <span class="hljs-variable language_">self</span>.is_temp_file = <span class="hljs-literal">True</span>
            threading.Thread(target=<span class="hljs-variable language_">self</span>.run_recognition, daemon=<span class="hljs-literal">True</span>).start()
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">try</span>:
                clipboard_content = <span class="hljs-variable language_">self</span>.clipboard_get().strip()
                <span class="hljs-keyword">if</span> clipboard_content.startswith(<span class="hljs-string">&#x27;&quot;&#x27;</span>) <span class="hljs-keyword">and</span> clipboard_content.endswith(<span class="hljs-string">&#x27;&quot;&#x27;</span>):
                    clipboard_content = clipboard_content[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>]

                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isfile(clipboard_content):
                    <span class="hljs-keyword">return</span>
                <span class="hljs-keyword">try</span>:
                    image = Image.<span class="hljs-built_in">open</span>(clipboard_content)
                    <span class="hljs-variable language_">self</span>.canvas.delete(<span class="hljs-variable language_">self</span>.canvas_text)
                    <span class="hljs-variable language_">self</span>.update_canvas_image(image)
                    <span class="hljs-variable language_">self</span>.temp_image_path = clipboard_content
                    <span class="hljs-variable language_">self</span>.is_temp_file = <span class="hljs-literal">False</span>
                    threading.Thread(target=<span class="hljs-variable language_">self</span>.run_recognition, daemon=<span class="hljs-literal">True</span>).start()
                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                    messagebox.showwarning(<span class="hljs-string">&quot;Paste Error&quot;</span>, <span class="hljs-string">f&quot;The pasted file is not a valid image.\nError: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)
            <span class="hljs-keyword">except</span> tk.TclError:
                messagebox.showwarning(<span class="hljs-string">&quot;Paste Error&quot;</span>, <span class="hljs-string">&quot;No image data or file path found on clipboard.&quot;</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_canvas_image</span>(<span class="hljs-params">self, pil_image</span>):
        canvas_width = <span class="hljs-variable language_">self</span>.canvas.winfo_width()
        canvas_height = <span class="hljs-variable language_">self</span>.canvas.winfo_height()
        img_copy = pil_image.copy()
        img_copy.thumbnail((canvas_width - <span class="hljs-number">10</span>, canvas_height - <span class="hljs-number">10</span>), Image.Resampling.LANCZOS)
        <span class="hljs-variable language_">self</span>.image_on_canvas = ImageTk.PhotoImage(img_copy)
        <span class="hljs-variable language_">self</span>.canvas.delete(<span class="hljs-string">&quot;all&quot;</span>)
        <span class="hljs-variable language_">self</span>.canvas.create_image(canvas_width / <span class="hljs-number">2</span>, canvas_height / <span class="hljs-number">2</span>, image=<span class="hljs-variable language_">self</span>.image_on_canvas)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_result_text</span>(<span class="hljs-params">self, text</span>):
        <span class="hljs-string">&quot;&quot;&quot;Safely updates the result Text widget and triggers formula rendering.&quot;&quot;&quot;</span>
        <span class="hljs-variable language_">self</span>.result_text.delete(<span class="hljs-string">&#x27;1.0&#x27;</span>, tk.END)
        <span class="hljs-variable language_">self</span>.result_text.insert(<span class="hljs-string">&#x27;1.0&#x27;</span>, text)
        <span class="hljs-comment"># Manually trigger the render process after programmatic update</span>
        <span class="hljs-variable language_">self</span>.on_text_change()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_recognition</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.simpletex_client:
            <span class="hljs-variable language_">self</span>.after(<span class="hljs-number">0</span>, <span class="hljs-keyword">lambda</span>: messagebox.showerror(<span class="hljs-string">&quot;Error&quot;</span>, <span class="hljs-string">&quot;Client not configured. Please set APP ID and Secret.&quot;</span>))
            <span class="hljs-keyword">return</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.temp_image_path:
            <span class="hljs-keyword">return</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-variable language_">self</span>.after(<span class="hljs-number">0</span>, <span class="hljs-variable language_">self</span>.update_result_text, <span class="hljs-string">&quot;Recognizing...&quot;</span>)
            model_to_use = <span class="hljs-variable language_">self</span>.model_type.get()
            latex_result = <span class="hljs-variable language_">self</span>.simpletex_client.recognize_formula(<span class="hljs-variable language_">self</span>.temp_image_path, model_type=model_to_use)
            <span class="hljs-variable language_">self</span>.after(<span class="hljs-number">0</span>, <span class="hljs-variable language_">self</span>.update_result_text, latex_result)
        <span class="hljs-keyword">except</span> (requests.exceptions.RequestException, ValueError, FileNotFoundError) <span class="hljs-keyword">as</span> e:
            <span class="hljs-variable language_">self</span>.after(<span class="hljs-number">0</span>, <span class="hljs-keyword">lambda</span>: messagebox.showerror(<span class="hljs-string">&quot;API Error&quot;</span>, <span class="hljs-built_in">str</span>(e)))
            <span class="hljs-variable language_">self</span>.after(<span class="hljs-number">0</span>, <span class="hljs-variable language_">self</span>.update_result_text, <span class="hljs-string">f&quot;Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)
        <span class="hljs-keyword">finally</span>:
            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.is_temp_file <span class="hljs-keyword">and</span> <span class="hljs-variable language_">self</span>.temp_image_path <span class="hljs-keyword">and</span> os.path.exists(<span class="hljs-variable language_">self</span>.temp_image_path):
                <span class="hljs-keyword">try</span>:
                    os.remove(<span class="hljs-variable language_">self</span>.temp_image_path)
                <span class="hljs-keyword">except</span> OSError <span class="hljs-keyword">as</span> e:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error removing temporary file: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)
            <span class="hljs-variable language_">self</span>.temp_image_path = <span class="hljs-literal">None</span>
            <span class="hljs-variable language_">self</span>.is_temp_file = <span class="hljs-literal">False</span>

    <span class="hljs-comment"># --- MODIFIED: Formula Rendering Logic ---</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_text_change</span>(<span class="hljs-params">self, event=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">&quot;&quot;&quot;</span>
<span class="hljs-string">        Handles debouncing for LaTeX rendering. It now checks if the text has actually changed.</span>
<span class="hljs-string">        &quot;&quot;&quot;</span>
        current_text = <span class="hljs-variable language_">self</span>.result_text.get(<span class="hljs-string">&quot;1.0&quot;</span>, tk.END).strip()

        <span class="hljs-comment"># --- IMPORTANT FIX: Only proceed if the text content has changed ---</span>
        <span class="hljs-keyword">if</span> current_text == <span class="hljs-variable language_">self</span>.last_known_text:
            <span class="hljs-keyword">return</span>

        <span class="hljs-variable language_">self</span>.last_known_text = current_text

        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.debounce_timer:
            <span class="hljs-variable language_">self</span>.after_cancel(<span class="hljs-variable language_">self</span>.debounce_timer)
        <span class="hljs-comment"># Start a timer to render the formula after 500ms of inactivity</span>
        <span class="hljs-variable language_">self</span>.debounce_timer = <span class="hljs-variable language_">self</span>.after(<span class="hljs-number">500</span>, <span class="hljs-variable language_">self</span>.start_formula_render_thread)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start_formula_render_thread</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">&quot;&quot;&quot;Gets text from the result box and starts the rendering thread.&quot;&quot;&quot;</span>
        <span class="hljs-comment"># The text is already stored in self.last_known_text from on_text_change</span>
        latex_string = <span class="hljs-variable language_">self</span>.last_known_text

        <span class="hljs-keyword">if</span> latex_string <span class="hljs-keyword">and</span> latex_string != <span class="hljs-string">&quot;Recognizing...&quot;</span>:
            <span class="hljs-comment"># Start rendering in a background thread to keep the UI responsive</span>
            threading.Thread(target=<span class="hljs-variable language_">self</span>.threaded_render_formula, args=(latex_string,), daemon=<span class="hljs-literal">True</span>).start()
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># Clear the canvas if the text box is empty or shows a status message</span>
            <span class="hljs-variable language_">self</span>.update_formula_canvas(<span class="hljs-literal">None</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">threaded_render_formula</span>(<span class="hljs-params">self, latex_str</span>):
        <span class="hljs-string">&quot;&quot;&quot;</span>
<span class="hljs-string">        Fetches the formula image from the CodeCogs API in a background thread.</span>
<span class="hljs-string">        Uses the modern https://latex.codecogs.com/png.image?... endpoint.</span>
<span class="hljs-string">        &quot;&quot;&quot;</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 1. Immediately inform the UI that rendering has started</span>
            <span class="hljs-variable language_">self</span>.after(<span class="hljs-number">0</span>, <span class="hljs-variable language_">self</span>.update_formula_canvas, <span class="hljs-string">&quot;Rendering...&quot;</span>)

            <span class="hljs-comment"># 2. Prepare the full LaTeX payload, including commands like \dpi</span>
            <span class="hljs-comment"># This ensures commands and the actual formula (including Chinese chars) are encoded together.</span>
            full_latex_payload = <span class="hljs-string">f&quot;\\dpi&#123;&#123;300&#125;&#125; <span class="hljs-subst">&#123;latex_str.strip()&#125;</span>&quot;</span>
            encoded_latex = urllib.parse.quote(full_latex_payload)

            <span class="hljs-comment"># 3. Construct the URL according to the new API documentation</span>
            url = <span class="hljs-string">f&quot;https://latex.codecogs.com/png.image?<span class="hljs-subst">&#123;encoded_latex&#125;</span>&quot;</span>

            <span class="hljs-comment"># 4. Make the network request (logic remains the same)</span>
            response = requests.get(url, timeout=<span class="hljs-number">10</span>)
            response.raise_for_status()  <span class="hljs-comment"># Raise an exception for bad status codes (4xx or 5xx)</span>

            <span class="hljs-comment"># 5. Process the response (logic remains the same)</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;image&#x27;</span> <span class="hljs-keyword">in</span> response.headers.get(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>):
                pil_image = Image.<span class="hljs-built_in">open</span>(io.BytesIO(response.content))
                <span class="hljs-variable language_">self</span>.after(<span class="hljs-number">0</span>, <span class="hljs-variable language_">self</span>.update_formula_canvas, pil_image)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># This can happen if LaTeX is invalid, API returns an error page instead of an image</span>
                error_message = <span class="hljs-string">f&quot;Render Error: Invalid LaTeX syntax or API issue.\nResponse was not an image.&quot;</span>
                <span class="hljs-variable language_">self</span>.after(<span class="hljs-number">0</span>, <span class="hljs-variable language_">self</span>.update_formula_canvas, error_message)

        <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
            error_message = <span class="hljs-string">f&quot;Render Error: Network request failed.\n<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>
            <span class="hljs-variable language_">self</span>.after(<span class="hljs-number">0</span>, <span class="hljs-variable language_">self</span>.update_formula_canvas, error_message)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            error_message = <span class="hljs-string">f&quot;Render Error: An unexpected error occurred.\n<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>
            <span class="hljs-variable language_">self</span>.after(<span class="hljs-number">0</span>, <span class="hljs-variable language_">self</span>.update_formula_canvas, error_message)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_formula_canvas</span>(<span class="hljs-params">self, content</span>):
        <span class="hljs-string">&quot;&quot;&quot;</span>
<span class="hljs-string">        Updates the formula canvas with either an image or a text message.</span>
<span class="hljs-string">        This method is always called on the main UI thread.</span>
<span class="hljs-string">        &quot;&quot;&quot;</span>
        <span class="hljs-variable language_">self</span>.formula_canvas.delete(<span class="hljs-string">&quot;all&quot;</span>)
        canvas_width = <span class="hljs-variable language_">self</span>.formula_canvas.winfo_width()
        canvas_height = <span class="hljs-variable language_">self</span>.formula_canvas.winfo_height()

        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(content, Image.Image):
            img_copy = content.copy()
            img_copy.thumbnail((canvas_width - <span class="hljs-number">10</span>, canvas_height - <span class="hljs-number">10</span>), Image.Resampling.LANCZOS)

            <span class="hljs-variable language_">self</span>.formula_image_on_canvas = ImageTk.PhotoImage(img_copy)
            <span class="hljs-variable language_">self</span>.formula_canvas.create_image(canvas_width / <span class="hljs-number">2</span>, canvas_height / <span class="hljs-number">2</span>, image=<span class="hljs-variable language_">self</span>.formula_image_on_canvas)
        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(content, <span class="hljs-built_in">str</span>):
            <span class="hljs-variable language_">self</span>.formula_canvas.create_text(canvas_width / <span class="hljs-number">2</span>, canvas_height / <span class="hljs-number">2</span>, text=content, font=(<span class="hljs-string">&#x27;Arial&#x27;</span>, <span class="hljs-number">12</span>),
                                            fill=<span class="hljs-string">&#x27;grey&#x27;</span>, justify=<span class="hljs-string">&#x27;center&#x27;</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-variable language_">self</span>.formula_canvas.create_text(canvas_width / <span class="hljs-number">2</span>, canvas_height / <span class="hljs-number">2</span>, text=<span class="hljs-string">&quot;Formula will be rendered here&quot;</span>,
                                            font=(<span class="hljs-string">&#x27;Arial&#x27;</span>, <span class="hljs-number">12</span>), fill=<span class="hljs-string">&#x27;grey&#x27;</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:
    app = App()
    app.mainloop()</code></pre>

</div>

<!-- post-guide -->

    <div class="post-guide">
        <div class="item left">
            
              <a href="/2025/06/20/2%20%E5%AD%A6%E4%B9%A0/3%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/1%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/2%20%E5%AE%9E%E8%B7%B5/2%20%E6%83%B3%E6%B3%95%E6%9E%84%E6%80%9D/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  2 想法构思
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2025/06/19/4%20%E6%9D%82%E9%A1%B9/1%20%E5%AE%9E%E7%94%A8%E5%B0%8F%E5%B7%A5%E5%85%B7/1%20%E4%BB%A3%E7%A0%81%E6%89%81%E5%B9%B3%E5%8C%96%E5%B0%8F%E5%B7%A5%E5%85%B7/">
                1 代码扁平化小工具
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>


<!-- comment - giscus -->


<!-- comment - valine -->


<script>
	
	
</script>

	</div>
	<div id="footer">
	<p>
		©<span id="footerYear-start">
			
		</span>-<span id="footerYear-end"></span>

		
				<a href="/">
					NicolasDavout
				</a>
				

					
							<br>
							Theme <a href="//github.com/wujun234/hexo-theme-tree" target="_blank">Tree</a>
							by <a href="//wujun.me" target="_blank">Wu Jun</a>
							Powered by <a href="//hexo.io" target="_blank">Hexo</a>
	</p>
</div>


	<script type="text/javascript">
		document.getElementById('footerYear-start').innerHTML = new Date().getFullYear() + '';
	</script>
	
		<script type="text/javascript">
			document.getElementById('footerYear-end').innerHTML = new Date().getFullYear() + '';
		</script>
		
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>